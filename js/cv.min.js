var CV=CV||{};CV.Image=function(t,r,n){this.width=t||0,this.height=r||0,this.data=n||[]},CV.grayscale=function(t,r){for(var n=t.data,e=r.data,i=n.length,o=0,a=0;o<i;o+=4)e[a++]=.299*n[o]+.587*n[o+1]+.114*n[o+2]+.5&255;return r.width=t.width,r.height=t.height,r},CV.threshold=function(t,r,n){var e,i=t.data,o=r.data,a=i.length,d=[];for(e=0;e<256;++e)d[e]=e<=n?0:255;for(e=0;e<a;++e)o[e]=d[i[e]];return r.width=t.width,r.height=t.height,r},CV.adaptiveThreshold=function(t,r,n,e){var i,o=t.data,a=r.data,d=o.length,h=[];for(CV.stackBoxBlur(t,r,n),i=0;i<768;++i)h[i]=i-255<=-e?255:0;for(i=0;i<d;++i)a[i]=h[o[i]-a[i]+255];return r.width=t.width,r.height=t.height,r},CV.otsu=function(t){var r,n,e,i=t.data,o=i.length,a=[],d=0,h=0,x=0,u=0,f=0,s=0;for(e=0;e<256;++e)a[e]=0;for(e=0;e<o;++e)a[i[e]]++;for(e=0;e<256;++e)h+=a[e]*e;for(e=0;e<256;++e)if(0!==(u+=a[e])){if(0===(f=o-u))break;x+=a[e]*e,r=x/u-(h-x)/f,n=u*f*r*r,n>s&&(s=n,d=e)}return d},CV.stackBoxBlurMult=[1,171,205,293,57,373,79,137,241,27,391,357,41,19,283,265],CV.stackBoxBlurShift=[0,9,10,11,9,12,10,11,12,9,13,13,10,9,13,13],CV.BlurStack=function(){this.color=0,this.next=null},CV.stackBoxBlur=function(t,r,n){var e,i,o,a,d,h,x,u,f,s,l=t.data,g=r.data,y=t.height,c=t.width,C=y-1,V=c-1,_=n+n+1,w=n+1,v=CV.stackBoxBlurMult[n],B=CV.stackBoxBlurShift[n];for(e=i=new CV.BlurStack,s=1;s<_;++s)e=e.next=new CV.BlurStack;for(e.next=i,d=0,f=0;f<y;++f){for(h=d,o=l[d],a=w*o,e=i,s=0;s<w;++s)e.color=o,e=e.next;for(s=1;s<w;++s)e.color=l[d+s],a+=e.color,e=e.next;for(e=i,u=0;u<c;++u)g[d++]=a*v>>>B,x=u+w,x=h+(x<V?x:V),a-=e.color-l[x],e.color=l[x],e=e.next}for(u=0;u<c;++u){for(d=u,h=d+c,o=g[d],a=w*o,e=i,s=0;s<w;++s)e.color=o,e=e.next;for(s=1;s<w;++s)e.color=g[h],a+=e.color,e=e.next,h+=c;for(e=i,f=0;f<y;++f)g[d]=a*v>>>B,x=f+w,x=u+(x<C?x:C)*c,a-=e.color-g[x],e.color=g[x],e=e.next,d+=c}return r},CV.gaussianBlur=function(t,r,n,e){var i=CV.gaussianKernel(e);return r.width=t.width,r.height=t.height,n.width=t.width,n.height=t.height,CV.gaussianBlurFilter(t,n,i,!0),CV.gaussianBlurFilter(n,r,i,!1),r},CV.gaussianBlurFilter=function(t,r,n,e){var i,o,a,d,h,x=t.data,u=r.data,f=t.height,s=t.width,l=0,g=n.length>>1;for(a=0;a<f;++a)for(d=0;d<s;++d){for(o=0,h=-g;h<=g;++h)e?(i=l+h,d+h<0?i=l:d+h>=s&&(i=l)):(i=l+h*s,a+h<0?i=l:a+h>=f&&(i=l)),o+=n[g+h]*x[i];u[l++]=e?o:o+.5&255}return r},CV.gaussianKernel=function(t){var r,n,e,i,o,a,d=[[1],[.25,.5,.25],[.0625,.25,.375,.25,.0625],[.03125,.109375,.21875,.28125,.21875,.109375,.03125]],h=[];if(t<=7&&t%2==1)h=d[t>>1];else{for(r=.5*(t-1),n=.8+.3*(r-1),e=-.5/(n*n),i=0,a=0;a<t;++a)o=a-r,i+=h[a]=Math.exp(e*o*o);for(i=1/i,a=0;a<t;++a)h[a]*=i}return h},CV.findContours=function(t,r){var n,e,i,o,a,d,h,x,u,f=t.width,s=t.height,l=[];for(n=CV.binaryBorder(t,r),e=CV.neighborhoodDeltas(f+2),i=f+3,a=1,x=0;x<s;++x,i+=2)for(u=0;u<f;++u,++i)0!==(o=n[i])&&(d=h=!1,1===o&&0===n[i-1]?d=!0:o>=1&&0===n[i+1]&&(h=!0),(d||h)&&(++a,l.push(CV.borderFollowing(n,i,a,{x:u,y:x},h,e))));return l},CV.borderFollowing=function(t,r,n,e,i,o){var a,d,h,x,u,f=[];f.hole=i,x=u=i?0:4;do{if(x=x-1&7,a=r+o[x],0!==t[a])break}while(x!==u);if(x===u)t[r]=-n,f.push({x:e.x,y:e.y});else for(d=r,4^x;;){u=x;do{h=d+o[++x]}while(0===t[h]);if(x&=7,x-1>>>0<u>>>0?t[d]=-n:1===t[d]&&(t[d]=n),f.push({x:e.x,y:e.y}),x,e.x+=CV.neighborhood[x][0],e.y+=CV.neighborhood[x][1],h===r&&d===a)break;d=h,x=x+4&7}return f},CV.neighborhood=[[1,0],[1,-1],[0,-1],[-1,-1],[-1,0],[-1,1],[0,1],[1,1]],CV.neighborhoodDeltas=function(t){for(var r=[],n=CV.neighborhood.length,e=0;e<n;++e)r[e]=CV.neighborhood[e][0]+CV.neighborhood[e][1]*t;return r.concat(r)},CV.approxPolyDP=function(t,r){var n,e,i,o,a,d,h,x,u,f,s,l={start_index:0,end_index:0},g={start_index:0,end_index:0},y=[],c=[],C=t.length;for(r*=r,s=0,u=0;u<3;++u)for(a=0,s=(s+g.start_index)%C,e=t[s],++s===C&&(s=0),f=1;f<C;++f)n=t[s],++s===C&&(s=0),h=n.x-e.x,x=n.y-e.y,(o=h*h+x*x)>a&&(a=o,g.start_index=f);for(a<=r?y.push({x:e.x,y:e.y}):(l.start_index=s,l.end_index=g.start_index+=l.start_index,g.start_index-=g.start_index>=C?C:0,g.end_index=l.start_index,g.end_index<g.start_index&&(g.end_index+=C),c.push({start_index:g.start_index,end_index:g.end_index}),c.push({start_index:l.start_index,end_index:l.end_index}));0!==c.length;){if(l=c.pop(),i=t[l.end_index%C],e=t[s=l.start_index%C],++s===C&&(s=0),l.end_index<=l.start_index+1)d=!0;else{for(a=0,h=i.x-e.x,x=i.y-e.y,u=l.start_index+1;u<l.end_index;++u)n=t[s],++s===C&&(s=0),(o=Math.abs((n.y-e.y)*h-(n.x-e.x)*x))>a&&(a=o,g.start_index=u);d=a*a<=r*(h*h+x*x)}d?y.push({x:e.x,y:e.y}):(g.end_index=l.end_index,l.end_index=g.start_index,c.push({start_index:g.start_index,end_index:g.end_index}),c.push({start_index:l.start_index,end_index:l.end_index}))}return y},CV.warp=function(t,r,n,e){var i,o,a,d,h,x,u,f,s,l,g,y,c,C,V,_,w,v,B,p,b,k,q,M=t.data,m=r.data,F=t.width,S=t.height,P=0;for(c=CV.getPerspectiveTransform(n,e-1),C=c[8],V=c[2],_=c[5],k=0;k<e;++k)for(C+=c[7],V+=c[1],_+=c[4],w=C,v=V,B=_,q=0;q<e;++q)w+=c[6],v+=c[0],B+=c[3],p=v/w,b=B/w,i=p>>>0,o=i===F-1?i:i+1,a=p-i,d=1-a,h=b>>>0,x=h===S-1?h:h+1,u=b-h,f=1-u,s=l=h*F,g=y=x*F,m[P++]=f*(d*M[s+i]+a*M[l+o])+u*(d*M[g+i]+a*M[y+o])&255;return r.width=e,r.height=e,r},CV.getPerspectiveTransform=function(t,r){var n=CV.square2quad(t);return n[0]/=r,n[1]/=r,n[3]/=r,n[4]/=r,n[6]/=r,n[7]/=r,n},CV.square2quad=function(t){var r,n,e,i,o,a,d,h=[];return r=t[0].x-t[1].x+t[2].x-t[3].x,n=t[0].y-t[1].y+t[2].y-t[3].y,0===r&&0===n?(h[0]=t[1].x-t[0].x,h[1]=t[2].x-t[1].x,h[2]=t[0].x,h[3]=t[1].y-t[0].y,h[4]=t[2].y-t[1].y,h[5]=t[0].y,h[6]=0,h[7]=0,h[8]=1):(e=t[1].x-t[2].x,i=t[3].x-t[2].x,o=t[1].y-t[2].y,a=t[3].y-t[2].y,d=e*a-i*o,h[6]=(r*a-i*n)/d,h[7]=(e*n-r*o)/d,h[8]=1,h[0]=t[1].x-t[0].x+h[6]*t[1].x,h[1]=t[3].x-t[0].x+h[7]*t[3].x,h[2]=t[0].x,h[3]=t[1].y-t[0].y+h[6]*t[1].y,h[4]=t[3].y-t[0].y+h[7]*t[3].y,h[5]=t[0].y),h},CV.isContourConvex=function(t){var r,n,e,i,o,a,d,h,x=0,u=!0,f=t.length,s=0,l=0;for(n=t[f-1],r=t[0],o=r.x-n.x,a=r.y-n.y;s<f;++s){if(++l===f&&(l=0),n=r,r=t[l],d=r.x-n.x,h=r.y-n.y,e=d*a,i=h*o,3===(x|=i>e?1:i<e?2:3)){u=!1;break}o=d,a=h}return u},CV.perimeter=function(t){for(var r,n,e=t.length,i=0,o=e-1,a=0;i<e;o=i++)r=t[i].x-t[o].x,n=t[i].y-t[o].y,a+=Math.sqrt(r*r+n*n);return a},CV.minEdgeLength=function(t){for(var r,n,e,i=t.length,o=0,a=i-1,d=1/0;o<i;a=o++)n=t[o].x-t[a].x,e=t[o].y-t[a].y,(r=n*n+e*e)<d&&(d=r);return Math.sqrt(d)},CV.countNonZero=function(t,r){var n,e,i=t.data,o=r.height,a=r.width,d=r.x+r.y*t.width,h=t.width-a,x=0;for(n=0;n<o;++n){for(e=0;e<a;++e)0!==i[d++]&&++x;d+=h}return x},CV.binaryBorder=function(t,r){var n,e,i=t.data,o=t.height,a=t.width,d=0,h=0;for(e=-2;e<a;++e)r[h++]=0;for(n=0;n<o;++n){for(r[h++]=0,e=0;e<a;++e)r[h++]=0===i[d++]?0:1;r[h++]=0}for(e=-2;e<a;++e)r[h++]=0;return r};